name: update-gif

on:
  schedule:
    # Runs every day at 00:00 UTC
    - cron: '0 0 * * *'
  workflow_dispatch: # Allows manual triggering

jobs:
  update-gif:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Update random GIF
        run: |
          # Get all GIF files from assets folder (excluding .DS_Store)
          GIFS=($(ls assets/*.gif 2>/dev/null || echo ""))

          if [ ${#GIFS[@]} -eq 0 ]; then
            echo "No GIF files found in assets folder"
            exit 1
          fi

          # Select a random GIF
          RANDOM_INDEX=$((RANDOM % ${#GIFS[@]}))
          SELECTED_GIF="${GIFS[$RANDOM_INDEX]}"

          echo "Selected GIF: $SELECTED_GIF"

          # Update README.md between the markers
          sed -i.bak '/<!--START_SECTION:random_gif-->/,/<!--END_SECTION:random_gif-->/ {
            /<!--START_SECTION:random_gif-->/!{
              /<!--END_SECTION:random_gif-->/!d
            }
          }' README.md

          # Insert the new GIF with overlay
          sed -i.bak '/<!--START_SECTION:random_gif-->/a\
          <div align="center" style="position: relative;">\
            <img src="./'$SELECTED_GIF'" alt="Random GIF" width="900"/>\
            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 100%;">\
              <img src="https://readme-typing-svg.herokuapp.com?font=Fira+Code&pause=1000&color=ffffff&center=true&vCenter=true&width=1000&lines=Hi+there+%F0%9F%91%8B%2C+I'\''m+Erwan;Full+Stack+Developer;Always+learning+new+things;Open+to+collaboration;Building+cool+stuff+%F0%9F%9A%80" alt="Typing SVG" />\
            </div>\
          </div>' README.md

          # Clean up backup file
          rm README.md.bak

      - name: Commit and push if changed
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          git add README.md
          git diff --quiet && git diff --staged --quiet || (git commit -m "Update random GIF" && git push)
